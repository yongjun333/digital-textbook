<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë””ì§€í„¸ êµê³¼ì„œ í”„ë¡œí† íƒ€ì… - 1ê³¼: ë›°ë‹¤ê°€ ë„˜ì–´ì¡Œì–´ìš”</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        .activity-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .activity-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        /* í™œì„±í™”ëœ íƒ­ ìŠ¤íƒ€ì¼ */
        .tab-active {
            border-color: #3B82F6;
            color: #3B82F6;
            font-weight: bold;
            background-color: #EFF6FF;
        }
        /* ìˆ¨ê²¨ì§„ í™”ë©´ ìŠ¤íƒ€ì¼ */
        .hidden-screen {
            display: none;
        }
        /* ë§í•˜ê¸° ë²„íŠ¼ ì• ë‹ˆë©”ì´ì…˜ */
        .mic-active {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
        /* ì‹ ì²´ ë¶€ìœ„ í•«ìŠ¤íŒŸ */
        .hotspot {
            position: absolute;
            width: 40px;
            height: 40px;
            background-color: rgba(255, 165, 0, 0.7);
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .hotspot:hover {
            background-color: rgba(255, 140, 0, 1);
            transform: scale(1.2);
        }
        /* ë“œë˜ê·¸ ì•¤ ë“œë¡­ ìŠ¤íƒ€ì¼ */
        .drop-zone-highlight {
            background-color: #E0F2FE;
            border-color: #0284C7;
        }
        .draggable-card {
            cursor: grab;
        }
        .draggable-card:active {
            cursor: grabbing;
        }
        /* ì •ë‹µ/ì˜¤ë‹µ íš¨ê³¼ */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-6px); }
            75% { transform: translateX(6px); }
        }
        .shake-error {
            animation: shake 0.4s ease-in-out;
        }
        .drop-zone-success {
            border-color: #22C55E !important;
            background-color: #F0FDF4;
        }
        .drop-zone-fail {
            border-color: #EF4444 !important;
            background-color: #FEF2F2;
        }
        .symptom-btn-selected {
            background-color: #F87171;
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container mx-auto p-4 max-w-5xl bg-white shadow-lg rounded-lg mt-5">
        
        <!-- í—¤ë”: ë‹¨ì› ì œëª© -->
        <header class="text-center p-4 border-b-2 border-blue-500">
            <h1 class="text-3xl font-bold text-gray-800">í‘œì¤€ í•œêµ­ì–´ ë””ì§€í„¸ êµê³¼ì„œ</h1>
            <h2 class="text-2xl font-semibold text-blue-600 mt-2">1ë‹¨ì›: ë›°ë‹¤ê°€ ë„˜ì–´ì¡Œì–´ìš”</h2>
        </header>

        <!-- ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ -->
        <main id="main-content" class="p-4">
            <!-- ì´ˆê¸° í™”ë©´ -->
            <div id="intro-screen">
                <div class="bg-blue-50 p-6 rounded-lg text-center">
                    <h3 class="text-xl font-bold text-gray-700">í•™ìŠµ ëª©í‘œ</h3>
                    <ul class="mt-4 text-left list-disc list-inside mx-auto max-w-md space-y-2">
                        <li>ì‹ ì²´ì™€ ê±´ê°•ì— ê´€ë ¨ëœ ë‚±ë§ê³¼ í‘œí˜„ì„ ìµí˜€ìš”.</li>
                        <li>ì‚¬ê³  ìƒí™©ì„ '~ë‹¤ê°€' ë¬¸ë²•ìœ¼ë¡œ ë§í•  ìˆ˜ ìˆì–´ìš”.</li>
                        <li>ë³‘ì›ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í‘œí˜„ì„ ìµíˆê³  ìƒí™©ì„ ì„¤ëª…í•  ìˆ˜ ìˆì–´ìš”.</li>
                    </ul>
                    <p class="mt-6 text-gray-600">ì•„ë˜ í™œë™ ì¹´ë“œë¥¼ í´ë¦­í•´ì„œ í•™ìŠµì„ ì‹œì‘í•´ ë³´ì„¸ìš”!</p>
                </div>

                <!-- í™œë™ ì„ íƒ ì¹´ë“œ -->
                <div class="grid md:grid-cols-3 gap-6 mt-8">
                    <div class="activity-card bg-orange-100 p-6 rounded-lg text-center" onclick="showScreen('body-parts')">
                        <h4 class="text-xl font-bold text-orange-800">1. ì‹ ì²´ ë¶€ìœ„</h4>
                        <p class="mt-2 text-orange-700">ìš°ë¦¬ ëª¸ì˜ ê° ë¶€ë¶„ ì´ë¦„ì„ ë°°ì›Œìš”.</p>
                    </div>
                    <div class="activity-card bg-green-100 p-6 rounded-lg text-center" onclick="showScreen('grammar-daga')">
                        <h4 class="text-xl font-bold text-green-800">2. ë¬¸ë²•: ~ë‹¤ê°€</h4>
                        <p class="mt-2 text-green-700">ë¬´ìŠ¨ ì¼ì´ ìˆì—ˆëŠ”ì§€ ì„¤ëª…í•´ìš”.</p>
                    </div>
                    <div class="activity-card bg-indigo-100 p-6 rounded-lg text-center" onclick="showScreen('hospital-treatment')">
                        <h4 class="text-xl font-bold text-indigo-800">3. ë³‘ì›ê³¼ ì¹˜ë£Œ</h4>
                        <p class="mt-2 text-indigo-700">ì•„í”Œ ë•Œ ì–´ë–»ê²Œ í•˜ëŠ”ì§€ ì•Œì•„ë´ìš”.</p>
                    </div>
                     <div class="activity-card bg-red-100 p-6 rounded-lg text-center" onclick="showScreen('cold-symptoms')">
                        <h4 class="text-xl font-bold text-red-800">4. ê°ê¸° ì¦ìƒ</h4>
                        <p class="mt-2 text-red-700">ê°ê¸°ì— ê±¸ë ¸ì„ ë•Œ ì¦ìƒì„ ë§í•´ìš”.</p>
                    </div>
                    <div class="activity-card bg-yellow-100 p-6 rounded-lg text-center" onclick="showScreen('review-activity')">
                        <h4 class="text-xl font-bold text-yellow-800">5. ì¢…í•© í™œë™</h4>
                        <p class="mt-2 text-yellow-700">ë°°ìš´ ë‚´ìš©ì„ ë³µìŠµí•´ìš”.</p>
                    </div>
                    <div class="activity-card bg-purple-100 p-6 rounded-lg text-center" onclick="showScreen('hospital-play')">
                        <h4 class="text-xl font-bold text-purple-800">6. ë³‘ì› ë†€ì´</h4>
                        <p class="mt-2 text-purple-700">ì–´ë””ê°€ ì•„í”Œ ë•Œ ì–´ëŠ ë³‘ì›ì— ê°ˆê¹Œìš”?</p>
                    </div>
                </div>
            </div>

            <!-- ê° í™œë™ í™”ë©´ (ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€) -->
            <div id="body-parts" class="hidden-screen">
                <button class="mb-4 bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600" onclick="showScreen('intro-screen')">â† ì²˜ìŒìœ¼ë¡œ</button>
                <h3 class="text-2xl font-bold text-center mb-4 text-orange-700">í™œë™ 1: ì‹ ì²´ ë¶€ìœ„ ì•Œì•„ë³´ê¸°</h3>
                <div class="flex flex-col md:flex-row gap-8">
                    <div class="w-full md:w-1/2 relative">
                        <img src="https://github.com/yongjun333/digital-textbook/blob/main/KakaoTalk_20250630_232204713.png?raw=true" alt="ì•„ì´ ì‹ ì²´ ë¶€ìœ„ ê·¸ë¦¼" class="w-full h-auto rounded-lg shadow-md" onerror="this.onerror=null;this.src='https://placehold.co/400x600/E0F2F1/333333?text=Image+Not+Found';">
                        <div class="hotspot" style="top: 5%; left: 45%;" onclick="speakAndShow('ë¨¸ë¦¬', 'word-display')"></div>
                        <div class="hotspot" style="top: 32%; left: 28%;" onclick="speakAndShow('ì–´ê¹¨', 'word-display')"></div>
                        <div class="hotspot" style="top: 50%; left: 48%;" onclick="speakAndShow('ë°°', 'word-display')"></div>
                        <div class="hotspot" style="top: 75%; left: 42%;" onclick="speakAndShow('ë¬´ë¦', 'word-display')"></div>
                        <div class="hotspot" style="top: 90%; left: 48%;" onclick="speakAndShow('ë°œ', 'word-display')"></div>
                    </div>
                    <div class="w-full md:w-1/2">
                        <div class="bg-orange-50 p-4 rounded-lg">
                            <p class="text-lg font-semibold text-center">ê·¸ë¦¼ì˜ ë™ê·¸ë¼ë¯¸ë¥¼ ëˆ„ë¥´ë©´ ì†Œë¦¬ê°€ ë‚˜ìš”.</p>
                            <div id="word-display" class="mt-4 text-center text-3xl font-bold text-orange-600 h-12"></div>
                        </div>
                        <div class="mt-6 bg-white p-4 rounded-lg shadow">
                            <h4 class="text-lg font-bold">ğŸµ ë…¸ë˜ ë”°ë¼ ë¶€ë¥´ê¸°</h4>
                            <p class="mt-2">"ë¨¸ë¦¬ ì–´ê¹¨ ë¬´ë¦ ë°œ" ë…¸ë˜ë¥¼ ë”°ë¼ ë¶ˆëŸ¬ë´ìš”!</p>
                            <div class="mt-4 aspect-w-16 aspect-h-11">
                               <iframe class="w-full h-full rounded-lg" src="https://www.youtube.com/embed/hHBo6QTr2u4" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="grammar-daga" class="hidden-screen">
                <button class="mb-4 bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600" onclick="showScreen('intro-screen')">â† ì²˜ìŒìœ¼ë¡œ</button>
                <h3 class="text-2xl font-bold text-center mb-4 text-green-700">í™œë™ 2: ë¬¸ë²• '~ë‹¤ê°€'</h3>
                <div class="bg-green-50 p-4 rounded-lg">
                    <h4 class="font-bold text-lg">ì‚¬ê³  ì´ìœ  ì• ë‹ˆë©”ì´ì…˜</h4>
                    <p>ìƒí™©ì„ ë³´ê³  ì–´ë–¤ ì¼ì´ ìˆì—ˆëŠ”ì§€ ë§í•´ë´ìš”.</p>
                    <div id="animation-container" class="mt-4 flex flex-col items-center bg-white p-4 rounded shadow">
                         <img id="animation-img" src="https://placehold.co/500x300/FFFBEB/333?text=Image" alt="ì• ë‹ˆë©”ì´ì…˜ ì¥ë©´" class="hidden rounded-lg mb-4 max-w-full md:max-w-xl mx-auto h-auto">
                         <div id="animation-youtube-container" class="hidden aspect-w-16 aspect-h-11 w-full md:max-w-xl mx-auto mb-4">
                            <iframe id="animation-youtube" class="w-full h-full rounded-lg" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                         </div>
                         <p id="animation-text" class="text-xl font-bold text-green-800"></p>
                    </div>
                    <div class="flex justify-center gap-2 mt-4 flex-wrap">
                        <button class="bg-green-200 px-3 py-1 rounded-full text-sm" onclick="showAnimation(0)">ë¼ë©´ ë“ì´ë‹¤ê°€</button>
                        <button class="bg-green-200 px-3 py-1 rounded-full text-sm" onclick="showAnimation(1)">ì² ë´‰ì— ë§¤ë‹¬ë¦¬ë‹¤ê°€</button>
                    </div>
                </div>
                <div class="mt-6 bg-white p-4 rounded-lg shadow">
                    <h4 class="text-lg font-bold">âœï¸ ë¬¸ì¥ ë§Œë“¤ê¸° (ë“œë˜ê·¸ ì•¤ ë“œë¡­)</h4>
                    <p class="mt-2">ì•„ë˜ ì¹´ë“œë¥¼ íšŒìƒ‰ ìƒìë¡œ ëŒì–´ë‹¤ ë†“ì•„ ë¬¸ì¥ì„ ì™„ì„±í•´ ë³´ì„¸ìš”.</p>
                    <div class="flex flex-col md:flex-row items-center justify-around gap-4 mt-4 p-4 bg-gray-50 rounded-lg">
                        <div id="card-container" class="flex flex-row md:flex-col gap-4">
                            <div id="drag1" class="draggable-card border-2 p-4 rounded-lg bg-white shadow" draggable="true">ìì „ê±°ë¥¼ íƒ€ë‹¤</div>
                            <div id="drag2" class="draggable-card border-2 p-4 rounded-lg bg-white shadow" draggable="true">ëŒê³¼ ë¶€ë”ªíˆë‹¤</div>
                        </div>
                        <div id="drop-zone" class="w-full md:w-1/2 h-24 border-4 border-dashed rounded-lg flex items-center justify-center text-gray-400 transition-colors">
                            ì—¬ê¸°ì— ì¹´ë“œë¥¼ ë†“ìœ¼ì„¸ìš”
                        </div>
                    </div>
                    <p id="dnd-feedback" class="mt-4 text-center text-xl font-bold h-8"></p>
                    <div class="text-center mt-2">
                      <button id="reset-dnd-btn" class="hidden bg-gray-400 text-white py-1 px-3 rounded" onclick="resetDragAndDrop()">ë‹¤ì‹œí•˜ê¸°</button>
                    </div>
                </div>
            </div>

            <div id="hospital-treatment" class="hidden-screen">
                <button class="mb-4 bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600" onclick="showScreen('intro-screen')">â† ì²˜ìŒìœ¼ë¡œ</button>
                <h3 class="text-2xl font-bold text-center mb-4 text-indigo-700">í™œë™ 3: ë³‘ì›ê³¼ ì¹˜ë£Œ</h3>
                
                <div class="mb-6 bg-white p-4 rounded-lg shadow">
                    <h4 class="text-lg font-bold">ğŸ™ï¸ ì˜ì‚¬ì—ê²Œ ë§í•´ë³´ê¸° <span class="text-xs text-blue-500">(GPT API ì—°ë™)</span></h4>
                    <p class="mt-2">"ë°°ê°€ ì•„íŒŒìš”." ë¼ê³  ë§í•´ë³´ì„¸ìš”.</p>
                    <button id="mic-btn-hospital" class="mt-2 w-full bg-blue-500 text-white py-2 px-4 rounded-full hover:bg-blue-600" onclick="startPronunciationTestActivity3()">ë§í•˜ê¸° ì‹œì‘</button>
                    <p id="pron-feedback-hospital" class="mt-2 text-center font-semibold"></p>
                    <div id="pron-feedback-details-hospital" class="hidden mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                        <h5 class="font-bold text-blue-800">ğŸ’¡ ë°œìŒ íŒ!</h5>
                        <p id="feedback-tip-mouth" class="mt-2 text-blue-700 flex items-center"></p>
                        <p id="feedback-tip-tongue" class="mt-2 text-blue-700 flex items-center"></p>
                    </div>
                </div>

                 <div class="bg-indigo-50 p-4 rounded-lg">
                    <h4 class="font-bold text-lg">ì–´ë–»ê²Œ ì¹˜ë£Œí• ê¹Œìš”?</h4>
                    <p>ìƒí™©ì— ë§ëŠ” ì¹˜ë£Œ ë°©ë²•ì„ ì•Œì•„ë´ìš”.</p>
                    <div class="grid md:grid-cols-2 gap-4 mt-4">
                        <div class="bg-white p-3 rounded-lg shadow text-center" onclick="speakAndShow('ë°¥ì„ ë¨¹ì€ ë‹¤ìŒì— ì´ë¥¼ ë‹¦ì•„ìš”', 'treatment-display')">
                            <img src="https://media.istockphoto.com/id/147306151/ko/%EC%82%AC%EC%A7%84/%EC%95%84%EB%A7%90%EA%B0%90-%EC%B6%A9%EC%A0%84.jpg?s=612x612&w=0&k=20&c=EY0Dn-Cr_4IR_Z5J4M9Zmu-uxnZ7uCN6AKySVpXJmHA=" class="mx-auto rounded w-full h-36 object-cover" alt="ì¶©ì¹˜ ê·¸ë¦¼" onerror="this.onerror=null;this.src='https://placehold.co/200x150/F3E8FF/333?text=Image+Error';">
                            <p class="mt-2 font-semibold">ì¶©ì¹˜ê°€ ìƒê²¼ì–´ìš”</p>
                        </div>
                        <div class="bg-white p-3 rounded-lg shadow text-center" onclick="speakAndShow('í•˜ë£¨ì— ë‘ ë²ˆ ì•ˆì•½ì„ ë„£ì–´ìš”', 'treatment-display')">
                            <img src="https://media.istockphoto.com/id/1257274991/ko/%EC%82%AC%EC%A7%84/%EB%B6%89%EC%9D%80-%ED%8C%8C%EC%97%B4-%ED%98%88%EA%B4%80%EC%9D%84-%EA%B0%80%EC%A7%84-%EB%AF%B8%EC%B7%A8%ED%95%99-%EC%95%84%EB%8F%99-%EC%86%8C%EB%85%84-%EB%88%88%EC%97%90-%ED%98%88%EA%B4%80-%EA%B2%B0%EB%A7%89%EC%97%BC-%EB%88%88%EC%9D%98-%EC%99%B8%EC%83%81-%EC%97%BC%EC%A6%9D-%EA%B0%90%EC%97%BC-%EC%95%8C%EB%A0%88%EB%A5%B4%EA%B8%B0-%EB%98%90%EB%8A%94-%EC%95%88%EA%B5%AC-%EC%95%95%EB%A0%A5%EC%9D%80-%EC%95%88%EA%B3%BC-%EC%9D%98%EC%82%AC%EC%99%80-%EC%A0%91%EC%B4%89%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0%EC%9E%85%EB%8B%88%EB%8B%A4.jpg?s=612x612&w=0&k=20&c=ZFBpsbIi_cU3nEPc3EFthZPPSWO24ku1lMydz_Gft2U=" class="mx-auto rounded w-full h-36 object-cover" alt="ëˆˆë³‘ ê·¸ë¦¼" onerror="this.onerror=null;this.src='https://placehold.co/200x150/F3E8FF/333?text=Image+Error';">
                            <p class="mt-2 font-semibold">ëˆˆë³‘ì— ê±¸ë ¸ì–´ìš”</p>
                        </div>
                    </div>
                    <div id="treatment-display" class="mt-4 text-center text-xl font-bold text-indigo-600 h-12"></div>
                </div>
                <div class="mt-6 bg-white p-4 rounded-lg shadow">
                    <h4 class="text-lg font-bold">ğŸ’Š ì•½ ë´‰íˆ¬ ì½ê¸°</h4>
                    <p class="mt-2">ì•½ ë´‰íˆ¬ë¥¼ í´ë¦­í•´ì„œ ì–´ë–»ê²Œ ë¨¹ëŠ”ì§€ ë“¤ì–´ë³´ì„¸ìš”.</p>
                    <div class="flex justify-center mt-4">
                        <img src="https://media.istockphoto.com/id/1169928112/ko/%EC%82%AC%EC%A7%84/%EC%9D%98%EC%82%AC-%EB%98%90%EB%8A%94-%EC%9D%98%EC%82%AC%EB%8A%94-%EB%82%A8%EC%84%B1-%ED%99%98%EC%9E%90-%EB%B3%91%EC%9B%90-%EB%B0%8F-%EC%9D%98%ED%95%99-%EA%B0%9C%EB%85%90%EC%97%90-%EC%95%8C-%EC%95%BD-%EC%9D%98%EB%A3%8C-%EC%B2%98%EB%B0%A9%EC%A0%84%EC%9D%84-%EA%B6%8C%EC%9E%A5-%ED%95%A9%EB%8B%88%EB%8B%A4.jpg?s=612x612&w=0&k=20&c=xRWlily0jtAb4LpQgZlTs4wU9jlv-oKuRaSKGe2gyTY=" class="rounded-lg cursor-pointer h-48 object-contain" alt="ì•½ ë´‰íˆ¬" onerror="this.onerror=null;this.src='https://placehold.co/200x300/EDE9FE/333?text=Image+Error';" onclick="speakAndShow('ì´ ì•½ì€ í•˜ë£¨ì— ì„¸ ë²ˆ, ì‹ì‚¬ í›„ 30ë¶„ ë’¤ì— ë“œì„¸ìš”.', 'medicine-instruction')">
                    </div>
                    <p id="medicine-instruction" class="mt-4 text-center font-semibold text-indigo-700 h-8"></p>
                </div>
            </div>
            
            <div id="cold-symptoms" class="hidden-screen">
                <button class="mb-4 bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600" onclick="showScreen('intro-screen')">â† ì²˜ìŒìœ¼ë¡œ</button>
                <h3 class="text-2xl font-bold text-center mb-4 text-red-700">í™œë™ 4: ê°ê¸° ì¦ìƒ</h3>
                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div class="bg-red-50 p-4 rounded-lg text-center" onclick="speakAndShow('ì—´ì´ ë‚˜ìš”', 'symptom-display')">
                        <img src="https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyNDEyMTRfMjg3%2FMDAxNzM0MTMxOTg4MDMz.fqROXg_VwjWgjG8mt550kKvHEeS0SwTfzoFipYxFqHkg.SkNFl3XKJLNQrbMCUlsHUESKr_e2rTF0NGWXG23-RzEg.JPEG%2F%25BE%25EE%25B8%25B0%25C0%25CC_%25B0%25ED%25BF%25AD.jpg&type=sc960_832" class="mx-auto rounded-full w-32 h-32 object-cover" alt="ì—´ì´ ë‚˜ëŠ” ê·¸ë¦¼" onerror="this.onerror=null;this.src='https://placehold.co/150x150/FEE2E2/333?text=Image+Error';">
                        <p class="mt-2 font-bold">ì—´ì´ ë‚˜ìš”</p>
                    </div>
                    <div class="bg-red-50 p-4 rounded-lg text-center" onclick="speakAndShow('ì½§ë¬¼ì´ ë‚˜ìš”', 'symptom-display')">
                        <img src="https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyNDAxMDJfMjE1%2FMDAxNzA0MTcyMDIxMjcw.NzeSETFd9P_qhm3gRo1hWqod0bu5F-bhAZNdX-Sg2Agg.KRHPiW5b-g3gyFBZzWj6AJIx2BSN6tf1GEUaWtxOwE8g.JPEG.andudtk12%2F20240102_140452.jpg&type=sc960_832" class="mx-auto rounded-full w-32 h-32 object-cover" alt="ì½§ë¬¼ì´ ë‚˜ëŠ” ê·¸ë¦¼" onerror="this.onerror=null;this.src='https://placehold.co/150x150/FEE2E2/333?text=Image+Error';">
                        <p class="mt-2 font-bold">ì½§ë¬¼ì´ ë‚˜ìš”</p>
                    </div>
                    <div class="bg-red-50 p-4 rounded-lg text-center" onclick="speakAndShow('ê¸°ì¹¨ì´ ë‚˜ìš”', 'symptom-display')">
                        <img src="https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAxOTExMjZfNTYg%2FMDAxNTc0NzQ3NDM2NzEw.DWsm6zwYTeAcKVOp2mxqrBNwVZaJqkUFCCVj1OPlINkg.Ii0TKY3Mgwg_ABChKgWr0C_jUaP2VjOnQV8Ri0wfbeYg.JPEG.pinokio2019%2Ftica101g19051403.jpg&type=sc960_832" class="mx-auto rounded-full w-32 h-32 object-cover" alt="ê¸°ì¹¨ì´ ë‚˜ëŠ” ê·¸ë¦¼" onerror="this.onerror=null;this.src='https://placehold.co/150x150/FEE2E2/333?text=Image+Error';">
                        <p class="mt-2 font-bold">ê¸°ì¹¨ì´ ë‚˜ìš”</p>
                    </div>
                    <div class="bg-red-50 p-4 rounded-lg text-center" onclick="speakAndShow('ì¶”ì›Œìš”', 'symptom-display')">
                        <img src="https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyMzExMjhfMjE3%2FMDAxNzAxMTM3NDg3MTMx.HkXjh8Djv0Oz4MV55E2KmFV0z6YGMJ3LHhlmKMZmsr0g._KHXJgMfalz2GUn2srGgAAv3ZFQTiX9ZBENoRk6yPecg.PNG.rental-day%2F%25C8%25AD%25C0%25E5%25BD%25C7%25C3%25DF%25BF%25F6.PNG&type=sc960_832" class="mx-auto rounded-full w-32 h-32 object-cover" alt="ì¶”ì›Œí•˜ëŠ” ê·¸ë¦¼" onerror="this.onerror=null;this.src='https://placehold.co/150x150/FEE2E2/333?text=Image+Error';">
                        <p class="mt-2 font-bold">ì¶”ì›Œìš”</p>
                    </div>
                </div>
                <div id="symptom-display" class="mt-4 text-center text-2xl font-bold text-red-600 h-12"></div>
                <div class="mt-6 bg-white p-4 rounded-lg shadow">
                    <h4 class="text-lg font-bold">ğŸ™ï¸ ì¦ìƒ ë§í•˜ê¸° <span class="text-xs text-blue-500">(GPT API ì—°ë™)</span></h4>
                    <p class="mt-2">ì•„ë˜ ì¦ìƒ ë²„íŠ¼ì„ ëˆ„ë¥´ê³ , ë”°ë¼ ë§í•´ë³´ì„¸ìš”.</p>
                    <div id="symptom-buttons" class="flex gap-2 justify-center mt-2 flex-wrap">
                        <button class="symptom-btn bg-red-200 px-3 py-1 rounded-full text-sm" onclick="handleSymptomButtonClick('ì—´ì´ ë‚˜ìš”')">ì—´ì´ ë‚˜ìš”</button>
                        <button class="symptom-btn bg-red-200 px-3 py-1 rounded-full text-sm" onclick="handleSymptomButtonClick('ì½§ë¬¼ì´ ë‚˜ìš”')">ì½§ë¬¼ì´ ë‚˜ìš”</button>
                        <button class="symptom-btn bg-red-200 px-3 py-1 rounded-full text-sm" onclick="handleSymptomButtonClick('ê¸°ì¹¨ì´ ë‚˜ìš”')">ê¸°ì¹¨ì´ ë‚˜ìš”</button>
                        <button class="symptom-btn bg-red-200 px-3 py-1 rounded-full text-sm" onclick="handleSymptomButtonClick('ì¶”ì›Œìš”')">ì¶”ì›Œìš”</button>
                    </div>
                    <div class="flex flex-col items-center mt-4">
                        <p id="pron-feedback-symptom" class="text-center font-bold text-blue-600 my-2 h-6"></p>
                        <button id="symptom-mic-btn" class="hidden bg-blue-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-600 mt-2" onclick="startPronunciationTestActivity4()">ë§í•˜ê¸° ì‹œì‘</button>
                    </div>
                </div>
            </div>
            
            <div id="review-activity" class="hidden-screen">
                <button class="mb-4 bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600" onclick="showScreen('intro-screen')">â† ì²˜ìŒìœ¼ë¡œ</button>
                <h3 class="text-2xl font-bold text-center mb-4 text-yellow-700">í™œë™ 5: ì¢…í•© í™œë™</h3>
                <div class="bg-yellow-50 p-4 rounded-lg">
                    <h4 class="font-bold text-lg">ì˜ì‚¬-í™˜ì ì—­í•  ëŒ€í™”</h4>
                    <p>ê·¸ë¦¼ì„ ë³´ê³  ëŒ€í™”ë¥¼ ì™„ì„±í•´ ë³´ì„¸ìš”.</p>
                    <div class="mt-4 bg-white p-4 rounded shadow">
                        <div class="flex gap-4 items-center">
                            <img src="https://media.istockphoto.com/id/1470505351/ko/%EC%82%AC%EC%A7%84/%EC%82%AC%EB%AC%B4%EC%8B%A4%EC%97%90%EC%84%9C-%EC%95%88%EA%B2%BD%EA%B3%BC-%ED%9C%B4%EB%8C%80%ED%8F%B0%EC%9D%84-%EB%93%A4%EA%B3%A0-%EC%9B%83%EA%B3%A0-%EC%9E%88%EB%8A%94-%EC%9D%98%EC%82%AC%EC%9D%98-%EC%B4%88%EC%83%81%ED%99%94.jpg?s=612x612&w=0&k=20&c=orBiaKPOpN35UXHgbrhHVZgo_ekXJKnPFN_0jMNPDAY=" class="rounded-full w-24 h-24 object-cover" alt="ì˜ì‚¬ ì´ë¯¸ì§€" onerror="this.onerror=null;this.src='https://placehold.co/100x100/FEF9C3/333?text=Image+Error';">
                            <p class="bg-gray-200 p-3 rounded-lg">ì–´ë””ê°€ ì•„íŒŒìš”?</p>
                        </div>
                        <div class="flex gap-4 items-center mt-4 justify-end">
                             <div class="bg-blue-200 p-3 rounded-lg">
                                <p id="patient-dialogue">ìš´ë™ì¥ì—ì„œ ________ ë„˜ì–´ì¡Œì–´ìš”.</p>
                             </div>
                             <img src="https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyNDA0MDRfMTk5%2FMDAxNzEyMjA5ODc4NTg4.MK1JnvOUyIFBQogIkTAXkCOWZU17aZ_1B4nU4mKOuR4g.ESik_mUuKEnUY57ezMOEzd5o-r1RJqmo3fgzWOr7Ejcg.PNG%2F222222.png&type=sc960_832" class="rounded-full w-24 h-24 object-cover cursor-pointer border-4 border-transparent hover:border-green-500" alt="ìš´ë™ì¥ì—ì„œ ë„˜ì–´ì§„ ì‚¬ì§„" onclick="checkHospitalAnswer('correct')">
                        </div>
                    </div>
                    <div class="mt-4 text-center">
                        <p class="font-semibold">ë¹ˆ ì¹¸ì— ë“¤ì–´ê°ˆ ë‚±ë§ ì¹´ë“œë¥¼ ê³ ë¥´ì„¸ìš”.</p>
                        <div class="flex gap-2 justify-center mt-2">
                            <button class="bg-yellow-200 p-2 rounded" onclick="fillBlank('ë›°ë‹¤ê°€')">ë›°ë‹¤ê°€</button>
                            <button class="bg-yellow-200 p-2 rounded" onclick="fillBlank('ë¨¹ë‹¤ê°€')">ë¨¹ë‹¤ê°€</button>
                            <button class="bg-yellow-200 p-2 rounded" onclick="fillBlank('ìë‹¤ê°€')">ìë‹¤ê°€</button>
                        </div>
                        <p id="review-feedback" class="mt-2 h-6 font-bold"></p>
                    </div>
                </div>
            </div>

            <div id="hospital-play" class="hidden-screen">
                <button class="mb-4 bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600" onclick="showScreen('intro-screen')">â† ì²˜ìŒìœ¼ë¡œ</button>
                <h3 class="text-2xl font-bold text-center mb-4 text-purple-700">í™œë™ 6: ë³‘ì› ë†€ì´</h3>
                <p class="text-center mb-4">ì•„ë˜ ì¦ìƒì´ ìˆì„ ë•Œ ì–´ëŠ ë³‘ì›ì— ê°€ì•¼ í• ê¹Œìš”? ë§ëŠ” ë³‘ì› ê·¸ë¦¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>
                <div class="flex flex-col items-center gap-4 bg-purple-50 p-4 rounded-lg">
                    <div class="aspect-w-16 aspect-h-9 w-full max-w-sm">
                        <iframe class="w-full h-full rounded-lg" src="https://www.youtube.com/embed/X2j2rGycr2s" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    </div>
                    <span class="text-2xl font-bold transform rotate-90 md:rotate-0">â†’</span>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="text-center">
                            <img src="https://search.pstatic.net/common/?src=https%3A%2F%2Fldb-phinf.pstatic.net%2F20200725_15%2F1595651983026cqm02_JPEG%2FuTTOte10FImEaLEn3bqTII7L.jpg&type=a340" class="rounded-lg cursor-pointer border-4 border-transparent hover:border-red-500 w-full h-32 object-cover" alt="ì •í˜•ì™¸ê³¼ ì´ë¯¸ì§€" onclick="checkHospitalAnswer('wrong')">
                            <p class="font-semibold mt-2">ì •í˜•ì™¸ê³¼</p>
                        </div>
                        <div class="text-center">
                            <img src="https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyNDAxMDZfMTky%2FMDAxNzA0NTUxMzQwNDg0.znQH0fK2dTK_EjfgJihuWgxrQFKBwmBEHN0vli8fU2cg.AInc4xI9QWhdNy-WKPsIF1DtUFr4WfjDRve5ATliyTIg.JPEG.myh2xr9zhxqxesa%2F12.jpg&type=sc960_832" class="rounded-lg cursor-pointer border-4 border-transparent hover:border-green-500 w-full h-32 object-cover object-contain" alt="ë‚´ê³¼ ì´ë¯¸ì§€" onclick="checkHospitalAnswer('correct')">
                            <p class="font-semibold mt-2">ë‚´ê³¼</p>
                        </div>
                        <div class="text-center">
                            <img src="https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyNTA1MTBfMjc1%2FMDAxNzQ2ODc1NzU1ODM4.wsDGZ_ob-0IzLgYkW18VysomP5KQl1-4ndobO4nXjpgg.D_7LSfwf-env4SyIo4CgRLH9fT4P7Qdo5Y7lennsw2cg.PNG%2F1.PNG&type=a340" class="rounded-lg cursor-pointer border-4 border-transparent hover:border-red-500 w-full h-32 object-cover" alt="ì´ë¹„ì¸í›„ê³¼ ì´ë¯¸ì§€" onclick="checkHospitalAnswer('wrong')">
                            <p class="font-semibold mt-2">ì´ë¹„ì¸í›„ê³¼</p>
                        </div>
                    </div>
                </div>
                <p id="hospital-feedback" class="mt-4 text-center h-6 font-bold text-xl"></p>
                
                <div class="mt-8 bg-white p-4 rounded-lg shadow">
                    <h4 class="text-lg font-bold">ë‚˜ë§Œì˜ ë¬¸ì¥ ë§Œë“¤ê¸° <span class="text-xs text-blue-500">(GPT API ì—°ë™)</span></h4>
                    <p class="mt-2 text-gray-600">ìì‹ ì´ ì•„íŒ ë˜ ê²½í—˜ì„ ì•„ë˜ì— ì¨ë³´ê±°ë‚˜ ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë§í•´ë³´ì„¸ìš”.</p>
                    <div id="chat-container" class="mt-4 border rounded-lg p-4 h-64 overflow-y-auto bg-gray-50 flex flex-col gap-4">
                        <!-- Chat messages will be appended here -->
                        <div class="flex justify-start">
                            <div class="bg-gray-200 text-gray-800 p-3 rounded-lg max-w-xs">
                                ì•ˆë…•í•˜ì„¸ìš”! ì–¸ì œ, ì–´ë””ê°€ ì•„íŒ ëŠ”ì§€ ì´ì•¼ê¸°í•´ ì¤„ë˜ìš”?
                            </div>
                        </div>
                    </div>
                    <div class="mt-2 flex gap-2">
                        <input type="text" id="user-chat-input" class="flex-grow border rounded-lg p-2" placeholder="ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”...">
                        <button id="chat-send-btn" class="bg-blue-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-600">ì „ì†¡</button>
                        <button id="chat-mic-btn" class="bg-green-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-600">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script>
        let currentScreen = 'intro-screen';
        const synth = window.speechSynthesis;

        function showScreen(screenId) {
            document.getElementById(currentScreen).classList.add('hidden-screen');
            document.getElementById(screenId).classList.remove('hidden-screen');
            currentScreen = screenId;
            if (screenId === 'grammar-daga') {
                resetDragAndDrop();
            }
        }

        function speakAndShow(text, displayId) {
            if (synth.speaking) {
                synth.cancel();
            }
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'ko-KR';
            utterance.pitch = 1;
            utterance.rate = 0.9;
            synth.speak(utterance);

            if (displayId) {
                document.getElementById(displayId).textContent = text;
            }
        }

        const animations = [
            { type: 'youtube', src: 'https://www.youtube.com/embed/3Hfub9JADj4', text: 'ë¼ë©´ì„ ë“ì´ë‹¤ê°€ ì†ì„ ë°ì—ˆì–´ìš”.' },
            { type: 'youtube', src: 'https://www.youtube.com/embed/ajbQlHnz6nc', text: 'ì² ë´‰ì— ë§¤ë‹¬ë¦¬ë‹¤ê°€ ë–¨ì–´ì¡Œì–´ìš”.' }
        ];

        function showAnimation(index, playSound = true) {
            const animationData = animations[index];
            const imgElement = document.getElementById('animation-img');
            const youtubeContainer = document.getElementById('animation-youtube-container');
            const youtubeIframe = document.getElementById('animation-youtube');
            const textElement = document.getElementById('animation-text');

            imgElement.classList.add('hidden');
            youtubeContainer.classList.add('hidden');
            youtubeIframe.src = ''; 

            if (animationData.type === 'youtube') {
                youtubeContainer.classList.remove('hidden');
                youtubeIframe.src = animationData.src;
            } else { 
                imgElement.classList.remove('hidden');
                imgElement.src = animationData.src;
            }

            textElement.textContent = animationData.text;
            if (playSound) {
                speakAndShow(animationData.text);
            }
        }
        
        function setInitialAnimation() {
            showAnimation(0, false);
        }
        setInitialAnimation();

        let currentSymptomToPractice = '';

        function setPronunciationTarget(buttonEl, symptom) {
            // ëª¨ë“  ë²„íŠ¼ì˜ ì„ íƒ ìŠ¤íƒ€ì¼ ì œê±°
            document.querySelectorAll('.symptom-btn').forEach(btn => {
                btn.classList.remove('symptom-btn-selected');
            });
            // í´ë¦­ëœ ë²„íŠ¼ì—ë§Œ ì„ íƒ ìŠ¤íƒ€ì¼ ì ìš©
            buttonEl.classList.add('symptom-btn-selected');

            currentSymptomToPractice = symptom;
            document.getElementById('selected-symptom').textContent = `"${symptom}" ë¼ê³  ë§í•´ë³´ì„¸ìš”.`;
            const micButton = document.getElementById('symptom-mic-btn');
            micButton.disabled = false;
            micButton.textContent = 'ë§í•˜ê¸° ì‹œì‘';
            // ê¸°ì¡´ onclick í•¸ë“¤ëŸ¬ë¥¼ ì œê±°í•˜ê³  ìƒˆë¡œ ì„¤ì •
            micButton.onclick = () => startPronunciationTestActivity4(symptom);
        }

        // OpenAI API Keyë¥¼ ì•„ë˜ ë³€ìˆ˜ì— ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: const OPENAI_API_KEY = 'sk-...';)
        const OPENAI_API_KEY = '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';

        // ----------- ê³µí†µ í•¨ìˆ˜: Whisper ìŒì„± ì¸ì‹ ë° GPT í”¼ë“œë°± -----------
        async function transcribeAudio(audioBlob) {
            const formData = new FormData();
            formData.append('file', audioBlob, 'audio.wav');
            formData.append('model', 'whisper-1');
            formData.append('language', 'ko');
            const response = await fetch('https://api.openai.com/v1/audio/transcriptions', {
                method: 'POST',
                headers: { 'Authorization': `Bearer ${OPENAI_API_KEY}` },
                body: formData
            });
            const data = await response.json();
            return data.text;
        }

        async function getPronunciationFeedback(userText, targetText) {
            const prompt = `í•™ìƒì´ "${targetText}"ë¥¼ ë§í•´ì•¼ í•˜ëŠ”ë° ì‹¤ì œë¡œ "${userText}"ë¼ê³  ë§í–ˆì–´. 
            
            ë°˜ë“œì‹œ í•œêµ­ì–´ ë°œìŒë§Œ í‰ê°€í•˜ê³ , ì™¸êµ­ì–´(í•œì, ì˜ì–´, ì¼ë³¸ì–´ ë“±)ëŠ” ë¬´ì‹œí•´ì£¼ì„¸ìš”.
            
            ë‹¤ìŒ ìˆœì„œë¡œ ì •í™•í•œ í”¼ë“œë°±ì„ ì œê³µí•´ì£¼ì„¸ìš”:
            
            1. ë°œìŒ ì •í™•ë„ í‰ê°€ (í¼ì„¼íŠ¸)
            2. ì‹¤ì œ ì¸ì‹ëœ ë°œìŒ "${userText}"ì™€ ëª©í‘œ ë°œìŒ "${targetText}"ë¥¼ ë¹„êµí•´ì„œ:
               - ì‹¤ì œë¡œ ì–´ë–¤ ë¶€ë¶„ì´ í‹€ë ¸ëŠ”ì§€ êµ¬ì²´ì ìœ¼ë¡œ ì§€ì  (ì˜ˆ: "ë°°ê°€"ì—ì„œ 'ë°±í•˜' ëŒ€ì‹ ì— 'ë°°'ë¡œ ë§í•´ì•¼ í•´ìš”)
               - ì˜¬ë°”ë¥¸ ë°œìŒ ë°©ë²•ì„ ì œì‹œ (ì˜ˆ: ì…ì„ ì¡°ê¸ˆ ì—´ì–´ 'ë°°' ì†Œë¦¬ë¥¼ ë¶€ë“œëŸ½ê²Œ ë‚´ë©´ ë  ê±°ì—ìš”)
            3. êµ¬ì²´ì ì¸ êµì • ë°©ë²•
            
            í‰ê°€ ê¸°ì¤€:
            - 80% ì´ìƒ: "ì •ë§ ì˜í–ˆì–´ìš”! ë°œìŒì´ ì•„ì£¼ ì •í™•í•´ìš”."
            - 60-79%: "ì˜í–ˆì–´ìš”! ì¡°ê¸ˆë§Œ ë” ì—°ìŠµí•˜ë©´ ì™„ë²½í•´ìš”."
            - 40-59%: "ì¡°ê¸ˆ ë” ë…¸ë ¥í•´ìš”. ì²œì²œíˆ ë§í•´ë³´ì„¸ìš”."
            - 40% ë¯¸ë§Œ: "ë‹¤ì‹œ í•œ ë²ˆ ë§í•´ë³´ì„¸ìš”."
            
            ì˜ˆì‹œ í˜•ì‹:
            "40% ì •í™•ë„ì—ìš”. 'ë°°ê°€'ì—ì„œ 'ë°±í•˜' ëŒ€ì‹ ì— 'ë°°'ë¡œ ë§í•´ì•¼ í•´ìš”. ì…ì„ ì¡°ê¸ˆ ì—´ì–´ 'ë°°' ì†Œë¦¬ë¥¼ ë¶€ë“œëŸ½ê²Œ ë‚´ë©´ ë  ê±°ì—ìš”."
            
            ì´ˆë“±í•™ìƒì´ ì´í•´í•˜ê¸° ì‰½ê²Œ í•œë‘ ë¬¸ì¥ìœ¼ë¡œ ì§§ê³  ê°„ê²°í•˜ê²Œ í”¼ë“œë°±í•´ì¤˜.`;
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${OPENAI_API_KEY}`
                },
                body: JSON.stringify({
                    model: 'gpt-3.5-turbo',
                    messages: [
                        { role: 'system', content: 'ë„ˆëŠ” ì¹œì ˆí•œ í•œêµ­ì–´ ë°œìŒ ì„ ìƒë‹˜ì´ì•¼. ë°˜ë“œì‹œ í•œêµ­ì–´ë§Œ í‰ê°€í•˜ê³ , ì™¸êµ­ì–´(í•œì, ì˜ì–´, ì¼ë³¸ì–´ ë“±)ëŠ” ë¬´ì‹œí•˜ê³ , ì‹¤ì œ ì¸ì‹ëœ ë°œìŒê³¼ ëª©í‘œ ë°œìŒì„ ì •í™•íˆ ë¹„êµí•´ì„œ, ì‹¤ì œë¡œ í‹€ë¦° ë¶€ë¶„ì„ êµ¬ì²´ì ìœ¼ë¡œ ì§€ì í•˜ê³ , ì˜¬ë°”ë¥¸ ë°œìŒ ë°©ë²•ì„ ì œì‹œí•˜ëŠ” í”¼ë“œë°±ì„ í•œë‘ ë¬¸ì¥ìœ¼ë¡œ ì§§ê³  ê°„ê²°í•˜ê²Œ í•´ì¤˜.' },
                        { role: 'user', content: prompt }
                    ]
                })
            });
            const data = await response.json();
            return data.choices[0].message.content.trim();
        }

        // ----------- í™œë™ 3: ë§í•˜ê¸° ì‹œì‘ ë²„íŠ¼ í´ë¦­ ì‹œ 'ìŒì„± ì¸ì‹ì¤‘ì…ë‹ˆë‹¤...' í‘œì‹œ -----------
        async function startPronunciationTestActivity3() {
            const button = document.getElementById('mic-btn-hospital');
            const feedbackEl = document.getElementById('pron-feedback-hospital');
            button.textContent = 'ìŒì„± ì¸ì‹ì¤‘ì…ë‹ˆë‹¤...';
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                const mediaRecorder = new MediaRecorder(stream);
                let audioChunks = [];
                mediaRecorder.ondataavailable = event => audioChunks.push(event.data);
                mediaRecorder.onstop = async () => {
                    button.textContent = 'ë§í•˜ê¸° ì‹œì‘';
                    feedbackEl.textContent = 'AIê°€ ë°œìŒ í”¼ë“œë°±ì„ ìƒì„±ì¤‘ì…ë‹ˆë‹¤...';
                    try {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                        const userText = await transcribeAudio(audioBlob);
                        const feedback = await getPronunciationFeedback(userText, 'ë°°ê°€ ì•„íŒŒìš”');
                        feedbackEl.textContent = feedback;
                    } catch (e) {
                        feedbackEl.textContent = 'ìŒì„± ì¸ì‹ ë˜ëŠ” AI í”¼ë“œë°±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                        setTimeout(() => {
                            feedbackEl.textContent = '';
                        }, 3000);
                    }
                };
                mediaRecorder.start();
                setTimeout(() => { if (mediaRecorder.state === 'recording') mediaRecorder.stop(); }, 3000); // 3ì´ˆ ë…¹ìŒ
            } catch (e) {
                button.textContent = 'ë§í•˜ê¸° ì‹œì‘';
                feedbackEl.textContent = 'ë§ˆì´í¬ ì‚¬ìš© ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.';
                setTimeout(() => {
                    feedbackEl.textContent = '';
                }, 3000);
            }
        }

        // ----------- í™œë™ 4: ì¦ìƒ ë²„íŠ¼ ì•ˆë‚´/ë§í•˜ê¸° ì‹œì‘ ë²„íŠ¼ ë™ì‘ ë³µì› -----------
        let selectedSymptomText = '';
        function handleSymptomButtonClick(targetText) {
            selectedSymptomText = targetText;
            const feedbackEl = document.getElementById('pron-feedback-symptom');
            feedbackEl.textContent = `"${targetText}"ë¼ê³  ë§í•´ë³´ì„¸ìš”.`;
            // 'ë§í•˜ê¸° ì‹œì‘' ë²„íŠ¼ ë³´ì´ê¸° ë° í…ìŠ¤íŠ¸ ì´ˆê¸°í™”
            const micBtn = document.getElementById('symptom-mic-btn');
            micBtn.classList.remove('hidden');
            micBtn.textContent = 'ë§í•˜ê¸° ì‹œì‘';
        }
        async function startPronunciationTestActivity4() {
            const feedbackEl = document.getElementById('pron-feedback-symptom');
            const micBtn = document.getElementById('symptom-mic-btn');
            if (!selectedSymptomText) {
                feedbackEl.textContent = 'ë¨¼ì € ì¦ìƒ ë²„íŠ¼ì„ ì„ íƒí•˜ì„¸ìš”.';
                return;
            }
            micBtn.textContent = 'ìŒì„± ì¸ì‹ì¤‘ì…ë‹ˆë‹¤...';
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                const mediaRecorder = new MediaRecorder(stream);
                let audioChunks = [];
                mediaRecorder.ondataavailable = event => audioChunks.push(event.data);
                mediaRecorder.onstop = async () => {
                    micBtn.textContent = 'ë§í•˜ê¸° ì‹œì‘';
                    feedbackEl.textContent = 'AIê°€ ë°œìŒ í”¼ë“œë°±ì„ ìƒì„±ì¤‘ì…ë‹ˆë‹¤...';
                    try {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                        const userText = await transcribeAudio(audioBlob);
                        const feedback = await getPronunciationFeedback(userText, selectedSymptomText);
                        feedbackEl.textContent = feedback;
                    } catch (e) {
                        feedbackEl.textContent = 'ìŒì„± ì¸ì‹ ë˜ëŠ” AI í”¼ë“œë°±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                        setTimeout(() => {
                            feedbackEl.textContent = '';
                        }, 3000);
                    }
                };
                mediaRecorder.start();
                setTimeout(() => { if (mediaRecorder.state === 'recording') mediaRecorder.stop(); }, 3000); // 3ì´ˆ ë…¹ìŒ
            } catch (e) {
                micBtn.textContent = 'ë§í•˜ê¸° ì‹œì‘';
                feedbackEl.textContent = 'ë§ˆì´í¬ ì‚¬ìš© ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.';
                setTimeout(() => {
                    feedbackEl.textContent = '';
                }, 3000);
            }
        }

        // ----------- í™œë™ 6: ChatGPT ì±—ë´‡ (ëŒ€í™” ë§¥ë½ ê¸°ì–µ, í•œë‘ ë¬¸ì¥ ì œí•œ) -----------
        let chatHistory = [
          { role: 'system', content: `ë„ˆëŠ” ì´ˆë“±í•™ìƒì˜ ì•„íŒ ë˜ ê²½í—˜ì„ ì¹œì ˆí•˜ê²Œ ë“¤ì–´ì£¼ëŠ” í•œêµ­ì¸ ë³´ê±´ ì„ ìƒë‹˜ì´ì•¼.\ní•™ìƒì´ ì–¸ì œ, ì–´ë””ê°€, ì–´ë–»ê²Œ ì•„íŒ ëŠ”ì§€ ë§í•˜ë©´\n- ë¨¼ì € ê³µê°ê³¼ ìœ„ë¡œë¥¼ í•´ì£¼ê³ \n- ì‹¤ì œ í•™êµ ë³´ê±´ì‹¤ì—ì„œ í•  ìˆ˜ ìˆëŠ” ì¡°ì–¸(ì‰¬ê¸°, ë³´í˜¸ì/ì„ ìƒë‹˜ê»˜ ì•Œë¦¬ê¸°, ë³‘ì›ê°€ê¸° ë“±)ë§Œ í•œë‘ ë¬¸ì¥ìœ¼ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ í•´ì¤˜.\n- ì°¨, í•œì•½, ë¯¼ê°„ìš”ë²•, ìŒì‹ ë“±ì€ ê¶Œí•˜ì§€ ë§ê³ , í•„ìš”í•˜ë©´ ë³´í˜¸ìë‚˜ ì„ ìƒë‹˜, ë³‘ì›ì— ì•Œë¦¬ë¼ê³  ì•ˆë‚´í•´.\n- ê°™ì€ ë§ì„ ë°˜ë³µí•˜ì§€ ë§ˆ.\n- ë„ˆë¬´ ê¸°ê³„ì ì´ê±°ë‚˜ ë”±ë”±í•œ ë§íˆ¬ëŠ” ì“°ì§€ ë§ê³ , ë”°ëœ»í•˜ê³  ìì—°ìŠ¤ëŸ¬ìš´ í•œêµ­ì–´ë¡œë§Œ ë‹µë³€í•´ì¤˜.\n- ì˜ì–´, ì¼ë³¸ì–´, í•œì ë“± ì™¸êµ­ì–´ëŠ” ì“°ì§€ ë§ê³ , ì˜¤ì§ í•œêµ­ì–´ë¡œë§Œ ë‹µë³€í•´.\n- ë‹µë³€ì€ í•­ìƒ í•œë‘ ë¬¸ì¥ìœ¼ë¡œ ì§§ê³  ê°„ê²°í•˜ê²Œ í•´ì¤˜.` }
        ];

        async function getChatGptResponse(userMessage) {
            chatHistory.push({ role: 'user', content: userMessage });
            // ìµœê·¼ 20ê°œë§Œ ìœ ì§€
            if (chatHistory.length > 21) chatHistory = [chatHistory[0], ...chatHistory.slice(-20)];
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${OPENAI_API_KEY}`
                },
                body: JSON.stringify({
                    model: 'gpt-3.5-turbo',
                    messages: chatHistory
                })
            });
            const data = await response.json();
            const gptReply = data.choices[0].message.content.trim();
            chatHistory.push({ role: 'assistant', content: gptReply });
            // ìµœê·¼ 20ê°œë§Œ ìœ ì§€
            if (chatHistory.length > 21) chatHistory = [chatHistory[0], ...chatHistory.slice(-20)];
            return gptReply;
        }

        function addMessageToChat(message, sender) {
            const chatContainer = document.getElementById('chat-container');
            const messageWrapper = document.createElement('div');
            const messageBubble = document.createElement('div');
            messageWrapper.classList.add('flex');
            messageBubble.textContent = message;
            messageBubble.classList.add('p-3', 'rounded-lg', 'max-w-xs');
            if (sender === 'user') {
                messageWrapper.classList.add('justify-end');
                messageBubble.classList.add('bg-blue-500', 'text-white');
            } else {
                messageWrapper.classList.add('justify-start');
                messageBubble.classList.add('bg-gray-200', 'text-gray-800');
            }
            messageWrapper.appendChild(messageBubble);
            chatContainer.appendChild(messageWrapper);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        async function handleUserMessage() {
            const chatInput = document.getElementById('user-chat-input');
            const message = chatInput.value.trim();
            if (message === '') return;
            addMessageToChat(message, 'user');
            chatInput.value = '';
            addMessageToChat('AIê°€ ë‹µë³€ì„ ìƒì„±ì¤‘ì…ë‹ˆë‹¤...', 'gpt');
            try {
                const gptResponse = await getChatGptResponse(message);
                // ë§ˆì§€ë§‰ 'ìƒì„±ì¤‘' ë©”ì‹œì§€ êµì²´
                const chatContainer = document.getElementById('chat-container');
                chatContainer.removeChild(chatContainer.lastChild);
                addMessageToChat(gptResponse, 'gpt');
            } catch (e) {
                addMessageToChat('AI ë‹µë³€ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'gpt');
            }
        }

        document.getElementById('chat-send-btn').addEventListener('click', handleUserMessage);
        document.getElementById('user-chat-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleUserMessage();
        });
        // ë§ˆì´í¬ ë²„íŠ¼ì€ ê¸°ì¡´ Web Speech APIë¡œ ìŒì„± ì…ë ¥ë§Œ ì§€ì›(Whisperë¡œ í™•ì¥ ê°€ëŠ¥)
        document.getElementById('chat-mic-btn').addEventListener('click', () => {
            const chatInput = document.getElementById('user-chat-input');
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                addMessageToChat('ë¸Œë¼ìš°ì €ê°€ ìŒì„± ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•Šì•„ìš”.', 'gpt');
                return;
            }
            const recognition = new SpeechRecognition();
            recognition.lang = 'ko-KR';
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                chatInput.value = transcript;
                handleUserMessage();
            };
            recognition.onerror = () => {
                addMessageToChat('ìŒì„±ì„ ì¸ì‹í•˜ì§€ ëª»í–ˆì–´ìš”. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.', 'gpt');
            };
            recognition.start();
        });

        const draggableCards = document.querySelectorAll('.draggable-card');
        const dropZone = document.getElementById('drop-zone');
        let droppedItems = [];

        draggableCards.forEach(card => {
            card.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', e.target.id);
                setTimeout(() => {
                    e.target.classList.add('hidden');
                }, 0);
            });

            card.addEventListener('dragend', (e) => {
                if (!droppedItems.includes(e.target.id)) {
                    e.target.classList.remove('hidden');
                }
            });
        });

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('drop-zone-highlight');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('drop-zone-highlight');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('drop-zone-highlight');
            const id = e.dataTransfer.getData('text');
            const draggedElement = document.getElementById(id);
            
            if (draggedElement && !droppedItems.includes(id)) {
                droppedItems.push(id);
                const newCard = draggedElement.cloneNode(true);
                newCard.classList.remove('hidden', 'draggable-card');
                newCard.removeAttribute('draggable');
                
                if (dropZone.innerText === 'ì—¬ê¸°ì— ì¹´ë“œë¥¼ ë†“ìœ¼ì„¸ìš”') {
                    dropZone.innerText = '';
                }
                dropZone.appendChild(newCard);
                dropZone.classList.remove('items-center', 'justify-center');

                if (droppedItems.length === 2) {
                    const feedbackEl = document.getElementById('dnd-feedback');
                    if (droppedItems[0] === 'drag1' && droppedItems[1] === 'drag2') {
                        dropZone.classList.add('drop-zone-success');
                        feedbackEl.innerHTML = '<span class="text-green-600">ğŸ‘ ì •ë‹µì´ì—ìš”!</span><br>ìì „ê±°ë¥¼ íƒ€ë‹¤ê°€ ëŒê³¼ ë¶€ë”ªí˜”ì–´ìš”.';
                        speakAndShow('ì •ë‹µì´ì—ìš”!');
                    } else {
                        dropZone.classList.add('drop-zone-fail', 'shake-error');
                        feedbackEl.innerHTML = '<span class="text-red-500">ğŸ¤” ìˆœì„œê°€ í‹€ë ¸ì–´ìš”. ë‹¤ì‹œ í•´ë³´ì„¸ìš”!</span>';
                        speakAndShow('ìˆœì„œê°€ í‹€ë ¸ì–´ìš”');
                        setTimeout(() => resetDragAndDrop(), 1500);
                    }
                    document.getElementById('reset-dnd-btn').classList.remove('hidden');
                }
            }
        });

        function resetDragAndDrop() {
            droppedItems = [];
            dropZone.innerHTML = 'ì—¬ê¸°ì— ì¹´ë“œë¥¼ ë†“ìœ¼ì„¸ìš”';
            if (!dropZone.classList.contains('items-center')) {
                dropZone.classList.add('items-center', 'justify-center');
            }
            dropZone.classList.remove('drop-zone-success', 'drop-zone-fail', 'shake-error');
            document.getElementById('dnd-feedback').textContent = '';
            document.getElementById('reset-dnd-btn').classList.add('hidden');
            draggableCards.forEach(card => card.classList.remove('hidden'));
        }

        // ----------- í™œë™ 5: ë‚±ë§ì¹´ë“œ(ë¹ˆì¹¸ ì±„ìš°ê¸°) & í™œë™ 6: ë³‘ì› í´ë¦­ í”¼ë“œë°± í•¨ìˆ˜ -----------
        function checkHospitalAnswer(result) {
            const feedbackEl = document.getElementById('hospital-feedback');
            if (result === 'correct') {
                feedbackEl.textContent = 'ì •ë‹µì´ì—ìš”! ì˜ ì°¾ì•˜ì–´ìš”.';
                feedbackEl.classList.remove('text-red-500');
                feedbackEl.classList.add('text-green-600');
            } else {
                feedbackEl.textContent = 'ì•„ì‰¬ì›Œìš”! ë‹¤ì‹œ í•œ ë²ˆ ìƒê°í•´ë³´ì„¸ìš”.';
                feedbackEl.classList.remove('text-green-600');
                feedbackEl.classList.add('text-red-500');
            }
        }

        function fillBlank(word) {
            const dialogue = document.getElementById('patient-dialogue');
            const feedback = document.getElementById('review-feedback');
            dialogue.textContent = `ìš´ë™ì¥ì—ì„œ ${word} ë„˜ì–´ì¡Œì–´ìš”.`;
            if (word === 'ë›°ë‹¤ê°€') {
                feedback.textContent = 'ì •ë‹µì´ì—ìš”!';
                feedback.classList.remove('text-red-500');
                feedback.classList.add('text-green-600');
            } else {
                feedback.textContent = 'ì•„ì‰¬ì›Œìš”! ë‹¤ì‹œ ì„ íƒí•´ë³´ì„¸ìš”.';
                feedback.classList.remove('text-green-600');
                feedback.classList.add('text-red-500');
            }
        }

    </script>
</body>
</html>
